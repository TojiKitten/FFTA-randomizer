type Codeinject = {
  offset: number;
  data: number[];
};

const skipTutorial: Codeinject[] = [
  { offset: 0xa19975, data: [0x04] }, //Change the game start to a different event (Ivalice Transformation)
  { offset: 0x9a7430, data: [0x1d, 0x02, 0x0d, 0x1c, 0x09, 0x00, 0x17, 0x02] }, // Exit Ivalice Transformation
  {
    offset: 0x9a797c,
    data: [
      0x4d,
      0x00,
      0x22,
      0x00,
      0x1a,
      0x01,
      0x03,
      0x01,
      0x1a,
      0x3b,
      0x04,
      0x01,
      0x1a,
      0x01,
      0x02,
      0x01,
      0x1d,
      0x03,
      0x17,
      0x05
    ]
  } //skip lizard men
];

const NoSkipTutorial: Codeinject[] = [
  { offset: 0x9a63a2, data: [0x1d, 0x02, 0x0d, 0x1c, 0x09, 0x00, 0x17, 0x02] }, // Exit Ivalice Transformation after Snowball
  {
    offset: 0x9a7fbe,
    data: [
      0x4d,
      0x00,
      0x22,
      0x00,
      0x1a,
      0x01,
      0x03,
      0x01,
      0x1a,
      0x3b,
      0x04,
      0x01,
      0x1a,
      0x01,
      0x02,
      0x01,
      0x1d,
      0x03,
      0x17,
      0x05
    ]
  } // Skip End of Lizard Men
];

const skipEverythingElse: Codeinject[] = [
  // Herb Picking Skip
  { offset: 0x9a87d9, data: [0x17, 0x05] },
  { offset: 0x9a8c4c, data: [0x1a, 0x02, 0x02, 0x01, 0x1d, 0x04, 0x17, 0x05] },
  // Thesis Hunt Skip
  { offset: 0x9a9784, data: [0x17, 0x05] },

  // Cheetas Skip
  { offset: 0x9a9a7c, data: [0x17, 0x05] },

  { offset: 0x9a9f48, data: [0x1a, 0x04, 0x02, 0x01, 0x1d, 0x06, 0x17, 0x05] },

  // Desert Peril Skip
  { offset: 0x9aa198, data: [0x17, 0x05] },

  { offset: 0x9aa88a, data: [0x1a, 0x05, 0x02, 0x01, 0x1d, 0x07, 0x17, 0x05] },

  // Twisted Flow Skip
  { offset: 0x9ab0b9, data: [0x1a, 0x06, 0x02, 0x01, 0x1d, 0x08, 0x17, 0x05] },

  // Antilaws Skip
  { offset: 0x9ab656, data: [0x17, 0x05] },

  { offset: 0x9abce5, data: [0x1a, 0x07, 0x02, 0x01, 0x1d, 0x09, 0x17, 0x05] },

  // Diamond Rain Skip
  { offset: 0x9ac2bc, data: [0x1a, 0x08, 0x02, 0x01, 0x1d, 0x0a, 0x17, 0x05] },

  // Hot Awakening Skip
  { offset: 0x9ac7ef, data: [0x1a, 0x09, 0x02, 0x01, 0x1d, 0x0b, 0x17, 0x05] },

  // Magic Wood Skip
  { offset: 0x9ace68, data: [0x1a, 0x0a, 0x02, 0x01, 0x1d, 0x0c, 0x17, 0x05] },

  // Emerald Keep Skip
  { offset: 0x9ad3dc, data: [0x1a, 0x0b, 0x02, 0x01, 0x1d, 0x0d, 0x17, 0x05] },

  // Pale Company Skip
  { offset: 0x9ad89b, data: [0x1a, 0x0c, 0x02, 0x01, 0x1d, 0x0e, 0x17, 0x05] },

  // Jagd Hunt Skip
  { offset: 0x9adbc3, data: [0x17, 0x05] },

  { offset: 0x9ae0e6, data: [0x17, 0x05] },

  // The Bounty Skip (none)

  // Golden Clock Skip
  { offset: 0x9af115, data: [0x1a, 0x0f, 0x02, 0x01, 0x1d, 0x12, 0x17, 0x05] },

  // Scouring Time Skip
  { offset: 0x9af74c, data: [0x17, 0x05] },

  {
    offset: 0x9afe8d,
    data: [0x1a, 0x10, 0x02, 0x01, 0x1d, 0x13, 0x0d, 0x1c, 0x38, 0x00, 0x17, 0x02]
  },

  { offset: 0x9b07e4, data: [0x1e, 0x03, 0x17, 0x05] },

  { offset: 0x9b0b76, data: [0x1a, 0x11, 0x02, 0x01, 0x1d, 0x14, 0x17, 0x05] },

  // The Big Find Skip
  { offset: 0x9b12b4, data: [0x1a, 0x12, 0x02, 0x01, 0x1d, 0x15, 0x17, 0x05] },

  // Desert Patrol Skip
  { offset: 0x9b19c8, data: [0x1a, 0x13, 0x02, 0x01, 0x1d, 0x16, 0x17, 0x05] },

  // Quiet Sands Skip
  { offset: 0x9b2694, data: [0x17, 0x05] },

  // Materite Now! Skip
  { offset: 0x9b2915, data: [0x1a, 0x15, 0x02, 0x01, 0x1d, 0x18, 0x17, 0x05] },

  { offset: 0x9b300b, data: [0x1a, 0x16, 0x02, 0x01, 0x1d, 0x19, 0x17, 0x05] },

  // Present Day Skip
  { offset: 0x9b45c0, data: [0x17, 0x05] },

  // Hidden Vein Skip
  { offset: 0x9b4750, data: [0x1a, 0x18, 0x02, 0x01, 0x1d, 0x1b, 0x17, 0x05] },

  { offset: 0x9b4848, data: [0x17, 0x05] },

  { offset: 0x9b4e2f, data: [0x1a, 0x19, 0x02, 0x01, 0x1d, 0x1c, 0x17, 0x05] },

  // To Ambervale Skip
  { offset: 0x9b52de, data: [0x17, 0x05] },

  { offset: 0x9b5835, data: [0x1a, 0x1a, 0x02, 0x01, 0x1d, 0x1d, 0x17, 0x05] },

  // Over the Hill Skip
  { offset: 0x9b5eef, data: [0x1a, 0x1b, 0x02, 0x01, 0x1d, 0x1e, 0x17, 0x05] }
];

/**
 * ROM Hack to skip post fight cutscenes, and optionally the opening two missions.
 * @param romData - The entirety of the ROM
 * @param skipIntro - Flag to skip or keep tutorial
 * @returns - A new buffer with updated values
 */
export function skipCutscenes(romData: Uint8Array, skipIntro: boolean): Uint8Array {
  let newRomData = romData;
  // Depending on if we skip the tutorial or not, set place to warp
  if (skipIntro) {
    skipTutorial.forEach((element) => {
      newRomData.set(element.data, element.offset);
    });
  } else {
    NoSkipTutorial.forEach((element) => {
      newRomData.set(element.data, element.offset);
    });
  }
  // After tutorial, everything is the same
  skipEverythingElse.forEach((element) => {
    newRomData.set(element.data, element.offset);
  });
  return newRomData;
}
